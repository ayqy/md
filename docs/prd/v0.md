一、依赖与构建准备

  - 补齐依赖安装：在 submodule 根目录执行一次完整安装（建议 pnpm install，若需 npm 亦可）。必须确认以下包在 workspace
    中实际可用：@codemirror/autocomplete、@codemirror/commands、@codemirror/lang-markdown、@codemirror/language、
    @codemirror/language-data、@codemirror/lint、@codemirror/search、@codemirror/state、@codemirror/view、@replit/
    codemirror-indentation-markers、reading-time 等。缺失任何一个都会导致我们侧无法重新构建桥接产物。
  - 统一构建命令：请以官方推荐方式构建 web 应用（如 pnpm --filter @md/web build 或 pnpm web build），并确保生成的 dist
    目录包含 JS/CSS/静态资源，与我们当前复制的 apps/web/dist 一致。

  二、暴露可编程接口（必须由 submodule 完成）

  为满足“主项目仅作为宿主、submodule 仍保持黑盒”的约束，麻烦在 submodule 中新增一个专用入口（可命名 packages/shared/
  integration/host-bridge.ts 等），并在构建阶段额外输出一个 JavaScript bundle（例如 md-host-bridge.js）。该 bundle 在加
  载后需要向全局对象挂载如下接口：

  declare global {
    interface Window {
      AYQYMD?: {
        /** 初始化编辑器，接管容器内的 DOM，返回实例句柄 */
        createEditor(options: {
          el: HTMLElement              // 宿主 DOM 容器（我们保证为空 div）
          value?: string               // 初始 Markdown 文本
          readOnly?: boolean           // 是否只读
          onChange?: (value: string) => void  // 文本变化回调
          onReady?: () => void         // （可选）实例准备完成回调
        }): Promise<AyqyMdEditorInstance>

        /** 单纯渲染 Markdown 并返回 HTML，供只读区域使用 */
        render(markdown: string): Promise<{ html: string; readingTime: number }>

        /** （可选）暴露主题/配置同步能力 */
        configure(options: {
          theme?: string
          fontFamily?: string
          fontSize?: string
          primaryColor?: string
          isMacCodeBlock?: boolean
          isShowLineNumber?: boolean
          isCountStatus?: boolean
          isCiteStatus?: boolean
          legend?: ReturnType<typeof getLegendConfig> // 若有复杂结构，请给出类型
        }): void
      }
    }
  }

  export interface AyqyMdEditorInstance {
    setContent(markdown: string): void
    getContent(): string
    setReadOnly(readOnly: boolean): void
    focus(): void
    destroy(): void
    /** （可选）允许主项目重新绑定回调，避免重建实例 */
    setOnChange(handler: (value: string) => void): void
  }

  实现要点：

  - createEditor 内部需自行挂载/卸载 Vue 应用、Pinia store、CodeMirror 等；我们只负责提供一个空容器。
  - 返回的 AyqyMdEditorInstance.destroy() 必须彻底释放事件监听、取消 Pinia/Watcher，避免内存泄漏。
  - render 应依赖 submodule 原有渲染逻辑，产出 HTML 字符串（以及必要的元信息，如阅读时长）。
  - 若存在主题/配置等全局状态，请通过 configure 或其它补充 API 暴露，不要要求宿主直接访问 Pinia store。
  - 避免默认在 document.body 等位置自动 createApp(...).mount('#app')；只有 createEditor 被调用时才初始化。

  三、构建产物交付

  - 构建时请在 dist 中额外输出上述 host bridge bundle 与相关 CSS（可将核心 CSS 独立为 md-host-bridge.css）。若沿用现有
    CSS 体量过大，可提炼出编辑器所需最小集合。
  - 产物文件命名最好稳定或提供 manifest（例如 manifest-host.json），便于我们同步到 public/md/ 后通过路径读取；示例结构：

    {
      "bridge": "static/js/md-host-bridge-<hash>.js",
      "styles": ["static/css/md-host-bridge-<hash>.css"],
      "assets": ["static/media/..."]
    }
  - 确保 bundle 能在浏览器环境直接执行，且不依赖 import.meta 等仅在 module 环境存在的对象；若需要，可输出 IIFE/UMD 形
    式。

  四、文档/使用说明

  - 提供简明文档（README 或 integration 指南），说明：构建命令、生成文件清单、window.AYQYMD API 规范及使用范例、必要的
    CSS 引入顺序等。
  - 列出任何需要的全局依赖（如必须先注入某些字体/样式），并确认是否依赖 CDN（我们倾向于全部走本地静态文件）。